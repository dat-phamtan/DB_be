<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Tìm kiếm sản phẩm cửa hàng</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:20px}
    label{display:inline-block;width:120px}
    input,select{padding:4px;margin:4px}
    table{border-collapse:collapse;margin-top:12px;width:100%}
    th,td{border:1px solid #ccc;padding:8px;text-align:left}
    th{background:#f2f2f2}
  </style>
</head>
<body>
  <h2>Tìm kiếm sản phẩm (Store)</h2>
  <form id="searchForm">
    <div>
      <label for="storeId">Store ID</label>
      <input id="storeId" name="storeId" type="number" value="1" required />
    </div>
    <div>
      <label for="tenSanPham">Tên sản phẩm</label>
      <input id="tenSanPham" name="tenSanPham" type="text" />
    </div>
    <div>
      <label for="tenDanhMuc">Tên danh mục</label>
      <input id="tenDanhMuc" name="tenDanhMuc" type="text" />
    </div>
    <div>
      <label for="giaTu">Giá từ</label>
      <input id="giaTu" name="giaTu" type="number" step="0.01" />
    </div>
    <div>
      <label for="giaDen">Giá đến</label>
      <input id="giaDen" name="giaDen" type="number" step="0.01" />
    </div>
    <div>
      <label for="sapXep">Sắp xếp</label>
      <select id="sapXep" name="sapXep">
        <option value="Ngay_dang_DESC">Ngày đăng (mới nhất)</option>
        <option value="Ngay_dang_ASC">Ngày đăng (cũ nhất)</option>
        <option value="Ten_ASC">Tên A-Z</option>
        <option value="Ten_DESC">Tên Z-A</option>
        <option value="Gia_ASC">Giá tăng dần</option>
        <option value="Gia_DESC">Giá giảm dần</option>
      </select>
    </div>
    <div>
      <button type="submit">Tìm kiếm</button>
    </div>
  </form>

  <div id="results"></div>

  <script>
    const form = document.getElementById('searchForm');
    const results = document.getElementById('results');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      results.innerHTML = 'Đang tải...';

      const params = new URLSearchParams();
      const storeId = document.getElementById('storeId').value;
      if(!storeId){ results.innerHTML = 'Store ID bắt buộc'; return; }
      params.set('storeId', storeId);

      const tenSanPham = document.getElementById('tenSanPham').value.trim();
      if(tenSanPham) params.set('tenSanPham', tenSanPham);

      const tenDanhMuc = document.getElementById('tenDanhMuc').value.trim();
      if(tenDanhMuc) params.set('tenDanhMuc', tenDanhMuc);

      const giaTu = document.getElementById('giaTu').value;
      if(giaTu) params.set('giaTu', giaTu);

      const giaDen = document.getElementById('giaDen').value;
      if(giaDen) params.set('giaDen', giaDen);

      const sapXep = document.getElementById('sapXep').value;
      if(sapXep) params.set('sapXep', sapXep);

      try{
        const res = await fetch('/api/products/search?' + params.toString());
        if(!res.ok) throw new Error(await res.text());
        const data = await res.json();
        renderTable(data);
      }catch(err){
        results.innerHTML = '<pre style="color:red">'+err+'</pre>';
      }
    });

    function renderTable(rows){
      if(!rows || rows.length === 0){ results.innerHTML = '<p>Không có kết quả</p>'; return; }

      // build header from keys
      const keys = Object.keys(rows[0]);
      let html = '<table><thead><tr>' + keys.map(k => '<th>'+escapeHtml(k)+'</th>').join('') + '</tr></thead><tbody>';
      for(const r of rows){
        html += '<tr>' + keys.map(k => '<td>'+escapeHtml(String(r[k] ?? ''))+'</td>').join('') + '</tr>';
      }
      html += '</tbody></table>';
      results.innerHTML = html;
    }

    function escapeHtml(s){
      return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
    }
  </script>
</body>
</html>
